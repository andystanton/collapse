<html>

<head>
  <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="node_modules/dom-to-image/dist/dom-to-image.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      domtoimage.toSvg($('html')[0])
        .then(function(dataUrl) {
          // convert body to svg
          var rawSvg = dataUrl.replace('data:image/svg+xml;charset=utf-8,', '');

          // parse svg into dom
          var parser = new DOMParser();
          var svgContents = parser.parseFromString(rawSvg, "image/svg+xml");

          // test ability to update svg dom
          var containerElement = $(svgContents).find(".container-box")[0];
          containerElement.style.backgroundColor = '#209999';

          // construct new data url from modified svg
          var newUrl = 'data:image/svg+xml;charset=utf-8,' + svgContents.documentElement.outerHTML;

          // create Image using new data url
          var img = new Image();
          img.src = newUrl;

          // create a canvas
          var canvas = $('<canvas>')
          canvas[0].width = img.width;
          canvas[0].height = img.width;

          // get the canvas' 2d context
          var ctx = canvas[0].getContext('2d');

          // draw the image on the canvas
          ctx.drawImage(img, 0, 0, img.width, img.height);

          // access pixel data
          canvas.click(function(event) {
            console.log(ctx.getImageData(event.offsetX, event.offsetY, 1, 1).data);
          });

          // remove all elements from the body and replace with the canvas
          $('body').empty();
          $('body').append(canvas);
        })
        .catch(function(error) {
          console.error('oops, something went wrong!', error);
        });
    });
  </script>
  <style type="text/css">
    .container-box {
      width: 200px;
      height: 100px;
      text-align: center;
      background-color: #CC99CC;
    }

    #foo {
      vertical-align: middle;
    }

    html {
      height: 100%;
    }

    body {
      min-height: 100%;
      background-color: #EEEEEE;
    }
  </style>
</head>

<body>
  <div id="container" class="container-box">
    <div id="foo">foo!</foo>
    </div>
</body>

</html>
